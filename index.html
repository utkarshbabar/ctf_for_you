<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Cypher - CTF Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0a0a;
            color: #e5e7eb;
            overflow-x: hidden;
        }
        #background-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        #background-container::before {
            content: '';
            position: absolute;
            width: 800px;
            height: 800px;
            background-image: radial-gradient(circle, rgba(59, 130, 246, 0.4) 0%, rgba(10, 10, 10, 0) 60%);
            animation: move-glow 25s infinite alternate ease-in-out;
            top: -20%;
            left: -20%;
        }
         #background-container::after {
            content: '';
            position: absolute;
            width: 600px;
            height: 600px;
            background-image: radial-gradient(circle, rgba(139, 92, 246, 0.3) 0%, rgba(10, 10, 10, 0) 60%);
            animation: move-glow-2 30s infinite alternate ease-in-out;
            bottom: -20%;
            right: -20%;
        }
        @keyframes move-glow {
            from { transform: translate(0, 0); }
            to { transform: translate(100vw, 100vh); }
        }
        @keyframes move-glow-2 {
            from { transform: translate(0, 0); }
            to { transform: translate(-100vw, -100vh); }
        }

        .glass-effect {
            background-color: rgba(17, 24, 39, 0.5);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .font-roboto-mono {
            font-family: 'Roboto Mono', monospace;
        }
        .challenge-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .challenge-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 100, 255, 0.1), 0 4px 6px -2px rgba(0, 100, 255, 0.05);
            border-color: rgba(59, 130, 246, 0.5);
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.75);
        }
        .solved-card {
            background-color: rgba(5, 150, 105, 0.2);
            border-color: #059669 !important;
        }
        .solved-card .status-indicator {
            background-color: #10B981;
            box-shadow: 0 0 10px #10B981;
        }
        .unsolved-card {
             border-color: #3b82f6;
        }
        .unsolved-card .status-indicator {
            background-color: #3b82f6;
            box-shadow: 0 0 10px #3b82f6;
        }
        .btn-primary {
            background: linear-gradient(90deg, #3b82f6, #6366f1);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.6);
            transform: scale(1.05);
        }
        .input-field {
            background-color: #1f2937;
            border: 1px solid #4b5563;
        }
        .input-field:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
        }
        .input-field.border-red-500 {
            border-color: #ef4444;
        }
        .resource-link {
            display: inline-block;
            background-color: #1f2937;
            border: 1px solid #4b5563;
            padding: 8px 16px;
            border-radius: 6px;
            text-decoration: none;
            color: #9ca3af;
            font-weight: 600;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .resource-link:hover {
            background-color: #374151;
            border-color: #6b7280;
            color: #e5e7eb;
        }
        .hint-button {
            background: none;
            border: none;
            color: #60a5fa;
            text-decoration: underline;
            cursor: pointer;
            padding: 0;
            font-size: 0.875rem;
        }
        .hint-button:hover {
            color: #93c5fd;
        }
        .hint-box {
            background-color: #1f2937;
            border-left: 4px solid #3b82f6;
            padding: 0.75rem;
            margin-top: 0.5rem;
            border-radius: 0.25rem;
            color: #d1d5db;
        }
        #share-score-btn, #rules-btn {
            background-color: rgba(31, 41, 55, 0.5);
            border: 1px solid #4b5563;
            transition: all 0.2s;
        }
        #share-score-btn:hover, #rules-btn:hover {
            background-color: #374151;
            border-color: #6b7280;
        }
        .social-link svg {
            transition: transform 0.2s ease-in-out, fill 0.2s ease-in-out;
        }
        .social-link:hover svg {
            transform: scale(1.2);
            fill: #60a5fa;
        }
    </style>
</head>
<body class="antialiased">
    <div id="background-container"></div>

    <!-- Header -->
    <header class="py-6 px-4 sm:px-6 lg:px-8 glass-effect sticky top-0 z-20">
        <div class="container mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold font-roboto-mono tracking-wider">
                    <span class="text-blue-400">&gt;</span> Project: <span class="text-white">CYPHER</span>
                </h1>
                <p class="text-sm text-gray-400">A Capture The Flag Challenge</p>
            </div>
            <div class="flex items-start gap-8">
                 <button id="rules-btn" title="View Rules" class="p-2 rounded-lg mt-8">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400"><path d="M15.5 2H8.6c-.4 0-.8.2-1.1.5-.3.3-.5.7-.5 1.1V21c0 .4.2.8.5 1.1.3.3.7.5 1.1.5h7.8c.4 0 .8-.2 1.1-.5.3-.3.5-.7.5-1.1V5.5L15.5 2z"/><path d="M15 2v4h4"/><path d="M10 12h4"/><path d="M10 16h4"/><path d="M8 8h2"/></svg>
                </button>
                <div>
                    <h2 class="text-lg font-semibold text-gray-300 text-right">TIMER</h2>
                    <p id="timer" class="text-3xl font-bold text-blue-400 font-roboto-mono">00:00:00</p>
                </div>
                <div class="text-right">
                    <div id="score-area" class="flex items-center gap-4">
                        <div>
                            <h2 class="text-lg font-semibold text-gray-300">SCORE</h2>
                            <p id="score" class="text-3xl font-bold text-blue-400 font-roboto-mono">0</p>
                        </div>
                        <button id="share-score-btn" title="Download PDF Report" class="p-2 rounded-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                        </button>
                    </div>
                     <div id="copy-feedback" class="text-xs text-green-400 h-4 mt-1"></div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto p-4 sm:p-6 lg:p-8">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="challenge-grid">
            <!-- Challenge cards will be injected here by JavaScript -->
        </div>
    </main>

    <!-- Challenge Modal -->
    <div id="challenge-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden modal-backdrop">
        <div id="modal-content" class="glass-effect rounded-lg shadow-2xl w-full max-w-2xl transform transition-all duration-300 ease-out scale-95 opacity-0">
            <div class="p-6">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 id="modal-title" class="text-2xl font-bold text-white"></h3>
                        <p id="modal-category" class="text-sm font-semibold text-blue-400 uppercase"></p>
                    </div>
                    <button id="close-modal-btn" class="text-gray-400 hover:text-white transition-colors text-3xl leading-none">&times;</button>
                </div>
                <div class="mt-4 text-gray-300 space-y-4">
                    <p id="modal-description"></p>
                    <div id="modal-resources" class="space-y-2"></div>
                    <div id="modal-hint-section"></div>
                    <p class="font-bold">Points: <span id="modal-points" class="text-blue-400 font-roboto-mono"></span></p>
                </div>
                <div class="mt-6">
                    <div id="modal-flag-form">
                        <label for="flag-input" class="block text-sm font-medium text-gray-400 mb-2">Enter Flag:</label>
                        <div class="flex flex-col sm:flex-row gap-2">
                            <input type="text" id="flag-input" class="flex-grow w-full px-3 py-2 rounded-md outline-none transition-all duration-200 input-field" placeholder="bhrCTF{...}">
                            <button id="submit-flag-btn" class="btn-primary text-white font-bold py-2 px-6 rounded-md">Submit</button>
                        </div>
                    </div>
                    <div id="modal-feedback" class="mt-4 text-center font-semibold"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- PDF Info Modal -->
    <div id="pdf-info-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden modal-backdrop">
        <div id="pdf-modal-content" class="glass-effect rounded-lg shadow-2xl w-full max-w-md transform transition-all duration-300 ease-out scale-95 opacity-0">
            <div class="p-6">
                <div class="flex justify-between items-start">
                    <h3 class="text-xl font-bold text-white">Generate PDF Report</h3>
                    <button id="close-pdf-modal-btn" class="text-gray-400 hover:text-white transition-colors text-3xl leading-none">&times;</button>
                </div>
                <p class="text-sm text-gray-400 mt-2">Enter your details to include in the report.</p>
                <div class="mt-6 space-y-4">
                    <div>
                        <label for="user-name" class="block text-sm font-medium text-gray-400 mb-1">Your Name</label>
                        <input type="text" id="user-name" class="w-full px-3 py-2 rounded-md outline-none transition-all duration-200 input-field" placeholder="Jane Doe">
                    </div>
                    <div>
                        <label for="linkedin-url" class="block text-sm font-medium text-gray-400 mb-1">LinkedIn Profile URL (Optional)</label>
                        <input type="url" id="linkedin-url" class="w-full px-3 py-2 rounded-md outline-none transition-all duration-200 input-field" placeholder="https://linkedin.com/in/janedoe">
                        <p id="linkedin-error" class="text-red-500 text-xs mt-1 h-4"></p>
                    </div>
                </div>
                <div class="mt-8">
                    <button id="generate-pdf-btn" class="w-full btn-primary text-white font-bold py-2 px-6 rounded-md">Open PDF Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Rules Modal -->
    <div id="rules-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden modal-backdrop">
        <div id="rules-modal-content" class="glass-effect rounded-lg shadow-2xl w-full max-w-2xl transform transition-all duration-300 ease-out scale-95 opacity-0">
            <div class="p-6">
                <div class="flex justify-between items-start">
                    <h3 class="text-2xl font-bold text-white">Rules & Instructions</h3>
                    <button id="close-rules-modal-btn" class="text-gray-400 hover:text-white transition-colors text-3xl leading-none">&times;</button>
                </div>
                <div class="mt-4 text-gray-300 space-y-4">
                    <div>
                        <h4 class="font-bold text-lg text-blue-400">1. Flag Format</h4>
                        <p>All flags must be submitted in the format: <code class="font-roboto-mono text-green-400 bg-gray-800 px-1 rounded">bhrCTF{...}</code>. Flags are case-sensitive.</p>
                    </div>
                     <div>
                        <h4 class="font-bold text-lg text-blue-400">2. Scoring</h4>
                        <p>Each challenge has a point value. Your total score is the sum of the points from all solved challenges.</p>
                    </div>
                     <div>
                        <h4 class="font-bold text-lg text-blue-400">3. Hints</h4>
                        <p>Hints are available for most challenges. Using a hint will result in a 10-point deduction from that challenge's score upon completion.</p>
                    </div>
                     <div>
                        <h4 class="font-bold text-lg text-blue-400">4. Conduct</h4>
                        <p>This is a friendly competition. Do not attack the infrastructure or other players. Focus on solving the challenges as intended.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Footer -->
    <footer class="text-center py-8 text-gray-500 text-sm mt-12 glass-effect">
        <p class="mb-4">Designed for elite hackers. Push your limits.</p>
        <div class="flex justify-center items-center gap-6">
            <span class="text-gray-400 font-semibold">CREATOR: @uttkarshbabar</span>
            <!-- Instagram -->
            <a href="https://www.instagram.com/utkarsh_babar_?igsh=d2gxMHI0MHYxZmxh" target="_blank" class="social-link" title="Instagram">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#9ca3af" class="w-6 h-6"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.85s-.011 3.585-.069 4.85c-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07s-3.585-.012-4.85-.07c-3.252-.148-4.771-1.691-4.919-4.919-.058-1.265-.069-1.645-.069-4.85s.011-3.585.069-4.85c.149-3.225 1.664-4.771 4.919-4.919C8.415 2.175 8.796 2.163 12 2.163zm0 1.441c-3.161 0-3.51.01-4.734.068-2.682.122-3.997 1.434-4.12 4.12C3.07 8.91 3.06 9.27 3.06 12s.01 3.09.068 4.314c.123 2.686 1.438 3.997 4.12 4.12C8.49 20.49 8.84 20.5 12 20.5s3.51-.01 4.734-.068c2.682-.122 3.997-1.434 4.12-4.12C20.93 15.09 20.94 14.73 20.94 12s-.01-3.09-.068-4.314c-.123-2.686-1.438-3.997-4.12-4.12C15.51 3.61 15.16 3.603 12 3.603zM12 7.25a4.75 4.75 0 1 0 0 9.5 4.75 4.75 0 0 0 0-9.5zm0 1.441a3.309 3.309 0 1 1 0 6.618 3.309 3.309 0 0 1 0-6.618zm5.438-2.88a1.2 1.2 0 1 0 0 2.4 1.2 1.2 0 0 0 0-2.4z"/></svg>
            </a>
            <!-- LinkedIn -->
            <a href="https://www.linkedin.com/in/utkarshbabar1?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app" target="_blank" class="social-link" title="LinkedIn">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#9ca3af" class="w-6 h-6"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
            </a>
            <!-- Twitter -->
            <a href="https://twitter.com/utkarshbabar" target="_blank" class="social-link" title="Twitter">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#9ca3af" class="w-6 h-6"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.51-.542 7.443-3.66 11.59-2.544 3.265-6.582 4.386-9.72 2.968-.932-.396-1.686-.932-2.303-1.566.249.03.477.062.676.062.932 0 1.803-.155 2.646-.465-.932 0-1.656-.465-2.212-1.24-.279-.465-.372-.93-.372-1.422 0-.03.031-.062.031-.093.248.093.496.186.744.186-.932-.62-1.566-1.656-1.566-2.822 0-.62.248-1.147.62-1.656 1.023 1.24 2.356 2.325 3.937 2.48.062-.186.093-.372.093-.558 0-1.422.961-2.48 2.325-2.48.682 0 1.24.279 1.656.682.496-.093.992-.279 1.422-.465-.155.527-.465.932-.837 1.24.465-.062.899-.186 1.302-.341-.28.465-.62.899-.992 1.24z"/></svg>
            </a>
            <!-- Other Link -->
            <a href="https://utkarshbabar.github.io" target="_blank" class="social-link" title="Portfolio/Website">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#9ca3af" class="w-6 h-6"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-3.39 16.95c-.176-.661-.253-1.422-.253-2.189 0-.827.077-1.587.253-2.271.19-.711.469-1.383.839-2.015.37-.632.827-1.215 1.371-1.748.544-.533 1.155-1.004 1.832-1.414.677-.409 1.414-.756 2.211-1.039.233-.084.473-.162.719-.234-1.523-.466-3.177-.702-4.96-.702-4.533 0-8.227 3.521-8.227 7.862 0 4.342 3.694 7.862 8.227 7.862 1.722 0 3.31-.223 4.765-.649-.947-.498-1.799-1.116-2.555-1.841-.757-.724-1.391-1.549-1.899-2.469zm8.39 1.05c0-4.341-3.693-7.862-8.227-7.862s-8.227 3.521-8.227 7.862c0 4.342 3.694 7.862 8.227 7.862s8.227-3.52 8.227-7.862z"/></svg>
            </a>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const { jsPDF } = window.jspdf;
            
            // --- BACKGROUND ANIMATION ---
            const canvas = document.getElementById('background-animation');
            if (canvas) {
                const ctx = canvas.getContext('2d');

                let width = canvas.width = window.innerWidth;
                let height = canvas.height = window.innerHeight;

                let columns = Math.floor(width / 20);
                const characters = "アァカサタナハマヤャラワガザダバパイィキシチニヒミリヰギジヂビピウゥクスツヌフムユュルグズブヅプエェケセテネヘメレヱゲゼデベペオォコソトノホモヨョロヲゴゾドボポヴッン0123456789";
                const charArray = characters.split('');
                let drops = [];

                for(let x = 0; x < columns; x++) {
                    drops[x] = 1;
                }

                function drawAnimation() {
                    ctx.fillStyle = 'rgba(10, 10, 10, 0.05)';
                    ctx.fillRect(0, 0, width, height);
                    
                    ctx.fillStyle = '#00f';
                    ctx.font = '15px monospace';

                    for(let i = 0; i < drops.length; i++) {
                        const text = charArray[Math.floor(Math.random() * charArray.length)];
                        ctx.fillText(text, i * 20, drops[i] * 20);

                        if(drops[i] * 20 > height && Math.random() > 0.975) {
                            drops[i] = 0;
                        }
                        drops[i]++;
                    }
                }
                
                let animationInterval = setInterval(drawAnimation, 33);
                
                window.addEventListener('resize', () => {
                    width = canvas.width = window.innerWidth;
                    height = canvas.height = window.innerHeight;
                    columns = Math.floor(width / 20);
                    drops = [];
                    for(let x = 0; x < columns; x++) {
                        drops[x] = 1;
                    }
                    clearInterval(animationInterval);
                    animationInterval = setInterval(drawAnimation, 33);
                });
            }

            // --- CTF LOGIC ---
            const challenges = [
                {
                    id: 'crypto-1',
                    title: 'Ancient Cipher',
                    category: 'Cryptography',
                    points: 100,
                    description: 'A Roman general used this simple substitution cipher to protect his military secrets. The key is to shift everything by 13. The encrypted message is: "GUR DHVPX OEBJA SBK WHZCF BIRE GUR YNML QBT."',
                    flag: 'bhrCTF{THEQUICKBROWNFOXJUMPSOVERTHELAZYDOG}',
                    hint: 'This is a classic Caesar cipher variant. Each letter is shifted by 13 places. You can find online tools to solve ROT13.',
                    solved: false,
                    hintUsed: false
                },
                {
                    id: 'basics-1',
                    title: 'View the Source',
                    category: 'Basics',
                    points: 50,
                    description: 'Sometimes the easiest way to find something is just to look for it. Check the resources below.',
                    flag: 'bhrCTF{W3B_D3V_T00L5_R0CK}',
                    solved: false,
                    hint: 'Most modern browsers have developer tools built-in. Try right-clicking on the page and selecting "Inspect" or "View Page Source". Look for comments in the HTML.',
                    resources: [
                        { name: 'Go to page', url: 'https://utkarshbabar.github.io/ctfinon.222/', download: false }
                    ],
                    hintUsed: false
                },
                {
                    id: 'rev-1',
                    title: 'The Gatekeeper',
                    category: 'Reverse Engineering',
                    points: 200,
                    description: 'We found a Java program that asks for a password. The developer left the source code, but the password check is... interesting. Find the correct password by analyzing the logic in the Java file.',
                    flag: 'bhrCTF{J@v@_1s_N0t_S3cur3}',
                    solved: false,
                    hint: 'Open the .java file in a text editor. Look for the main method and the part of the code that compares the user\'s input to a string.',
                    resources: [
                        { name: 'bhrctf.java', url: './bhrctf.java', download: true }
                    ],
                    hintUsed: false
                },
                {
                    id: 'forensics-1',
                    title: 'Hidden in Plain Sight',
                    category: 'Forensics',
                    points: 150,
                    description: 'We found a suspicious image file. It looks normal, but we suspect data is hidden within its bytes using steganography. Analyze the file to find the flag.',
                    flag: 'bhrCTF{STEGANOGRAPHY_IS_COOL}',
                    solved: false,
                    hint: 'Steganography tools can hide data inside images. Sometimes, data is just appended to the end of the file. Try opening the image in a hex editor or using a tool like steghide.',
                    resources: [
                        { name: 'd.png', url: 'https://placehold.co/600x400/000000/FFFFFF/png?text=Download+Me', download: true }
                    ],
                    hintUsed: false
                },
                {
                    id: 'crypto-2',
                    title: 'Encoded Message',
                    category: 'Cryptography',
                    points: 150,
                    description: 'We intercepted an encoded message, but we\'re not sure what format it is. Can you decode it? The message is: YmhyQ1RGe2lfYW0gaGVyX2FuZF95b3UyMjMxMjMzfQ==',
                    flag: 'bhrCTF{i_am her_and_you2231233}',
                    hint: 'This is a very common encoding on the web. A good cook knows how to handle this with the right tools. Maybe a CyberChef?',
                    solved: false,
                    hintUsed: false
                },
                 {
                    id: 'web-1',
                    title: 'Secret Directory',
                    category: 'Web Exploitation',
                    points: 50,
                    description: 'Web servers often have hidden pages or directories that aren\'t linked from the main site. Can you find the secret administrative area? The flag might be there.',
                    flag: 'bhrCTF{H1DD3N_P4G3S_4R3_FUN}',
                    hint: 'Common names for admin panels are /admin, /dashboard, or /secret. Try navigating to these paths directly in the URL.',
                    solved: false,
                    hintUsed: false
                }
            ];
            // --- END OF CONFIGURATION ---

            const challengeGrid = document.getElementById('challenge-grid');
            const scoreEl = document.getElementById('score');
            const timerEl = document.getElementById('timer');
            const modal = document.getElementById('challenge-modal');
            const modalContent = document.getElementById('modal-content');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const submitFlagBtn = document.getElementById('submit-flag-btn');
            const flagInput = document.getElementById('flag-input');
            const modalFeedback = document.getElementById('modal-feedback');
            const modalResources = document.getElementById('modal-resources');
            const modalHintSection = document.getElementById('modal-hint-section');
            const shareScoreBtn = document.getElementById('share-score-btn');
            const copyFeedbackEl = document.getElementById('copy-feedback');

            // PDF Modal Elements
            const pdfInfoModal = document.getElementById('pdf-info-modal');
            const pdfModalContent = document.getElementById('pdf-modal-content');
            const closePdfModalBtn = document.getElementById('close-pdf-modal-btn');
            const generatePdfBtn = document.getElementById('generate-pdf-btn');
            const userNameInput = document.getElementById('user-name');
            const linkedinUrlInput = document.getElementById('linkedin-url');
            const linkedinErrorEl = document.getElementById('linkedin-error');
            
            // Rules Modal Elements
            const rulesModal = document.getElementById('rules-modal');
            const rulesModalContent = document.getElementById('rules-modal-content');
            const rulesBtn = document.getElementById('rules-btn');
            const closeRulesModalBtn = document.getElementById('close-rules-modal-btn');
            
            let currentChallengeId = null;
            let timerInterval;
            let startTime;
            let elapsedTime = 0;

            function formatTime(seconds) {
                const h = Math.floor(seconds / 3600).toString().padStart(2, '0');
                const m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
                const s = (seconds % 60).toString().padStart(2, '0');
                return `${h}:${m}:${s}`;
            }

            function startTimer() {
                startTime = new Date();
                timerInterval = setInterval(() => {
                    elapsedTime = Math.floor((new Date() - startTime) / 1000);
                    timerEl.textContent = formatTime(elapsedTime);
                }, 1000);
            }

            function stopTimer() {
                clearInterval(timerInterval);
            }

            function updateTotalScore() {
                const totalScore = challenges
                    .filter(c => c.solved)
                    .reduce((sum, c) => {
                        const pointsEarned = c.hintUsed ? Math.max(0, c.points - 10) : c.points;
                        return sum + pointsEarned;
                    }, 0);
                scoreEl.textContent = totalScore;
            }

            function renderChallenges() {
                challengeGrid.innerHTML = '';
                challenges.forEach(challenge => {
                    const card = document.createElement('div');
                    card.className = `challenge-card p-5 rounded-lg border-2 cursor-pointer ${challenge.solved ? 'solved-card' : 'unsolved-card'}`;
                    card.dataset.id = challenge.id;

                    card.innerHTML = `
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-xl font-bold text-white">${challenge.title}</h3>
                            <div class="status-indicator w-3 h-3 rounded-full"></div>
                        </div>
                        <p class="text-sm font-semibold text-blue-400 uppercase">${challenge.category}</p>
                        <p class="mt-4 text-lg font-roboto-mono text-gray-300">Points: ${challenge.points}</p>
                        ${challenge.solved ? '<p class="mt-2 font-bold text-green-400">SOLVED</p>' : ''}
                    `;
                    card.addEventListener('click', () => openModal(challenge.id));
                    challengeGrid.appendChild(card);
                });
            }

            function openModal(id) {
                currentChallengeId = id;
                const challenge = challenges.find(c => c.id === id);
                if (!challenge) return;

                document.getElementById('modal-title').textContent = challenge.title;
                document.getElementById('modal-category').textContent = challenge.category;
                document.getElementById('modal-description').innerHTML = challenge.description;
                document.getElementById('modal-points').textContent = challenge.points;
                
                modalResources.innerHTML = '';
                if (challenge.resources && challenge.resources.length > 0) {
                    const resourcesTitle = document.createElement('h4');
                    resourcesTitle.className = 'font-bold text-gray-200 mb-2';
                    resourcesTitle.textContent = 'Resources:';
                    modalResources.appendChild(resourcesTitle);
                    challenge.resources.forEach(resource => {
                        const link = document.createElement('a');
                        link.href = resource.url;
                        link.textContent = resource.name;
                        link.className = 'resource-link';
                        if (resource.download) {
                            link.setAttribute('download', '');
                        } else {
                           link.setAttribute('target', '_blank');
                           link.setAttribute('rel', 'noopener noreferrer');
                        }
                        modalResources.appendChild(link);
                    });
                }

                modalHintSection.innerHTML = '';
                if (challenge.hint && !challenge.solved) {
                    if (challenge.hintUsed) {
                        modalHintSection.innerHTML = `<div class="hint-box">${challenge.hint}</div>`;
                    } else {
                        const hintButton = document.createElement('button');
                        hintButton.textContent = 'Show Hint';
                        hintButton.className = 'hint-button';
                        hintButton.onclick = () => {
                            if (!hintButton.dataset.confirmed) {
                                hintButton.textContent = 'Reveal for -10 points? Click again to confirm.';
                                hintButton.dataset.confirmed = 'true';
                                return;
                            }
                            challenge.hintUsed = true;
                            modalHintSection.innerHTML = `<div class="hint-box">${challenge.hint}</div>`;
                        };
                        modalHintSection.appendChild(hintButton);
                    }
                }

                flagInput.value = '';
                modalFeedback.textContent = '';
                modalFeedback.className = 'mt-4 text-center font-semibold';

                const form = document.getElementById('modal-flag-form');
                if (challenge.solved) {
                    form.classList.add('hidden');
                    modalFeedback.textContent = 'You have already solved this challenge.';
                    modalFeedback.classList.add('text-green-400');
                } else {
                    form.classList.remove('hidden');
                    flagInput.disabled = false;
                    submitFlagBtn.disabled = false;
                }

                modal.classList.remove('hidden');
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            }

            function closeModal(modalElement, contentElement) {
                 contentElement.classList.add('scale-95', 'opacity-0');
                 contentElement.classList.remove('scale-100', 'opacity-100');
                 setTimeout(() => {
                    modalElement.classList.add('hidden');
                 }, 300);
            }
            
            function handleSubmit() {
                const challenge = challenges.find(c => c.id === currentChallengeId);
                const submittedFlag = flagInput.value.trim();

                if (submittedFlag === challenge.flag) {
                    challenge.solved = true;
                    modalFeedback.textContent = 'Correct! Flag accepted.';
                    modalFeedback.className = 'mt-4 text-center font-bold text-green-400';
                    flagInput.disabled = true;
                    submitFlagBtn.disabled = true;
                    updateTotalScore();
                    renderChallenges();
                    
                    const allSolved = challenges.every(c => c.solved);
                    if (allSolved) {
                        stopTimer();
                    }

                    setTimeout(() => closeModal(modal, modalContent), 1500);
                } else {
                    modalFeedback.textContent = 'Incorrect flag. Try again.';
                    modalFeedback.className = 'mt-4 text-center font-bold text-red-500';
                    flagInput.style.animation = 'shake 0.5s';
                    setTimeout(() => flagInput.style.animation = '', 500);
                }
            }
            
            function generatePdfReport(userName, linkedinUrl) {
                const doc = new jsPDF();
                const currentScore = scoreEl.textContent;
                const solvedChallenges = challenges.filter(c => c.solved);
                const date = new Date().toLocaleDateString();
                const pageHeight = doc.internal.pageSize.height;
                let yPos = 0;

                // --- PDF Header ---
                const header = () => {
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(16);
                    doc.setTextColor(59, 130, 246); // Blue color
                    doc.text('> Project: CYPHER', 20, 20);
                    
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(10);
                    doc.setTextColor(156, 163, 175); // Gray color
                    doc.text('CTF Completion Report', 20, 26);

                    if(userName) {
                        doc.setFont('helvetica', 'bold');
                        doc.setFontSize(10);
                        doc.setTextColor(45, 45, 45);
                        doc.text(userName, 190, 20, { align: 'right' });
                    }
                    if(linkedinUrl) {
                        doc.setFont('helvetica', 'normal');
                        doc.setFontSize(9);
                        doc.setTextColor(59, 130, 246);
                        doc.textWithLink('LinkedIn Profile', 190, 26, { url: linkedinUrl, align: 'right' });
                    }
                    
                    doc.setDrawColor(55, 65, 81); // Gray border color
                    doc.line(20, 32, 190, 32);
                };

                // --- PDF Footer ---
                const footer = (pageNum) => {
                    const pageStr = `Page ${pageNum}`;
                    doc.setFontSize(8);
                    doc.setTextColor(156, 163, 175);
                    doc.text(pageStr, 190, pageHeight - 10, { align: 'right' });
                    doc.text(`Report Generated: ${date}`, 20, pageHeight - 10);
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(10);
                    doc.setTextColor(100, 100, 100);
                    doc.text('@uttkarshbabar', 105, pageHeight - 15, { align: 'center' });
                };

                // --- First Page ---
                header(1);
                
                // --- Score Section ---
                doc.setFontSize(28);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(45, 45, 45);
                doc.text(currentScore, 105, 55, { align: 'center' });
                doc.setFontSize(12);
                doc.setTextColor(100, 100, 100);
                doc.text('FINAL SCORE', 105, 62, { align: 'center' });

                // --- Status Section ---
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(45, 45, 45);
                doc.text('Status Summary', 20, 80);
                doc.setDrawColor(229, 231, 235);
                doc.line(20, 83, 190, 83);
                
                doc.setFontSize(11);
                doc.setFont('helvetica', 'normal');
                doc.text(`Challenges Completed: ${solvedChallenges.length} / ${challenges.length}`, 22, 92);
                doc.text(`Time Taken: ${formatTime(elapsedTime)}`, 22, 100);
                yPos = 115;

                // --- Completed Challenges Table ---
                if (solvedChallenges.length > 0) {
                    doc.setFontSize(14);
                    doc.setFont('helvetica', 'bold');
                    doc.text("Completed Challenge Details", 20, yPos);
                    yPos += 3;
                    doc.setDrawColor(229, 231, 235);
                    doc.line(20, yPos, 190, yPos);
                    yPos += 10;

                    // Table Header
                    doc.setFontSize(10);
                    doc.setFont('helvetica', 'bold');
                    doc.setTextColor(100, 100, 100);
                    doc.text('CHALLENGE TITLE', 22, yPos);
                    doc.text('CATEGORY', 120, yPos);
                    doc.text('POINTS', 188, yPos, { align: 'right' });
                    yPos += 2;
                    doc.setDrawColor(156, 163, 175);
                    doc.line(22, yPos, 188, yPos);
                    yPos += 8;

                    // Table Rows
                    doc.setFont('helvetica', 'normal');
                    doc.setTextColor(45, 45, 45);
                    doc.setFontSize(10);
                    solvedChallenges.forEach((c, index) => {
                        if (yPos > pageHeight - 30) {
                            footer(doc.internal.getNumberOfPages());
                            doc.addPage();
                            header(doc.internal.getNumberOfPages());
                            yPos = 45;
                        }
                        const points = c.hintUsed ? `${c.points - 10}*` : c.points.toString();
                        doc.text(c.title, 22, yPos);
                        doc.text(c.category, 120, yPos);
                        doc.text(points, 188, yPos, { align: 'right' });
                        yPos += 10;
                    });
                    
                    if(challenges.some(c => c.hintUsed && c.solved)) {
                        doc.setFontSize(8);
                        doc.setTextColor(156, 163, 175);
                        doc.text("*Hint was used for this challenge (-10 points).", 22, yPos + 5);
                    }
                } else {
                    doc.setFontSize(12);
                    doc.setTextColor(100);
                    doc.text("No challenges completed yet. Keep trying!", 105, 120, null, null, "center");
                }
                
                // --- Submission Instructions ---
                yPos += 15;
                if (yPos > pageHeight - 40) {
                    footer(doc.internal.getNumberOfPages());
                    doc.addPage();
                    header(doc.internal.getNumberOfPages());
                    yPos = 45;
                }
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(45, 45, 45);
                doc.text("Submission Instructions", 20, yPos);
                yPos += 3;
                doc.setDrawColor(229, 231, 235);
                doc.line(20, yPos, 190, yPos);
                yPos += 10;

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text("Congratulations! Share this report on LinkedIn and tag the creator", 22, yPos);
                yPos += 5;
                doc.text("to showcase your skills.", 22, yPos);

                // --- Creator Links ---
                yPos += 15;
                if (yPos > pageHeight - 40) {
                    footer(doc.internal.getNumberOfPages());
                    doc.addPage();
                    header(doc.internal.getNumberOfPages());
                    yPos = 45;
                }
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(45, 45, 45);
                doc.text("Creator Information", 20, yPos);
                yPos += 3;
                doc.setDrawColor(229, 231, 235);
                doc.line(20, yPos, 190, yPos);
                yPos += 10;

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(10);
                doc.setTextColor(59, 130, 246);

                const creatorLinks = [
                    { title: 'Instagram', url: 'https://www.instagram.com/utkarsh_babar_?igsh=d2gxMHI0MHYxZmxh' },
                    { title: 'LinkedIn', url: 'https://www.linkedin.com/in/utkarshbabar1?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app' },
                    { title: 'Twitter', url: 'https://twitter.com/utkarshbabar' },
                    { title: 'Portfolio/Website', url: 'https://utkarshbabar.github.io' }
                ];

                creatorLinks.forEach(link => {
                    doc.textWithLink(link.title, 22, yPos, { url: link.url });
                    yPos += 7;
                });


                footer(doc.internal.getNumberOfPages());
                doc.output('dataurlnewwindow');
            }

            shareScoreBtn.addEventListener('click', () => {
                pdfInfoModal.classList.remove('hidden');
                setTimeout(() => {
                    pdfModalContent.classList.remove('scale-95', 'opacity-0');
                    pdfModalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            });
            
            generatePdfBtn.addEventListener('click', () => {
                const userName = userNameInput.value.trim();
                const linkedinUrl = linkedinUrlInput.value.trim();

                linkedinErrorEl.textContent = '';
                linkedinUrlInput.classList.remove('border-red-500');

                if (linkedinUrl && !linkedinUrl.startsWith('https://')) {
                    linkedinErrorEl.textContent = 'URL must start with https://';
                    linkedinUrlInput.classList.add('border-red-500');
                    return;
                }

                generatePdfReport(userName, linkedinUrl);
                closeModal(pdfInfoModal, pdfModalContent);
            });

            closeModalBtn.addEventListener('click', () => closeModal(modal, modalContent));
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModal(modal, modalContent);
            });
            
            closePdfModalBtn.addEventListener('click', () => closeModal(pdfInfoModal, pdfModalContent));
            pdfInfoModal.addEventListener('click', (e) => {
                if (e.target === pdfInfoModal) closeModal(pdfInfoModal, pdfModalContent);
            });

            submitFlagBtn.addEventListener('click', handleSubmit);
            flagInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') {
                    handleSubmit();
                }
            });
            
            rulesBtn.addEventListener('click', () => {
                rulesModal.classList.remove('hidden');
                setTimeout(() => {
                    rulesModalContent.classList.remove('scale-95', 'opacity-0');
                    rulesModalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            });

            closeRulesModalBtn.addEventListener('click', () => closeModal(rulesModal, rulesModalContent));
            rulesModal.addEventListener('click', (e) => {
                if (e.target === rulesModal) closeModal(rulesModal, rulesModalContent);
            });

            // Initial render
            renderChallenges();
            updateTotalScore();
            startTimer();
        });
    </script>
    <style>
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
    </style>
</body>
</html>
